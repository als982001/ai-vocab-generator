# Supabase 사전 준비 체크리스트

---

## 1. 데이터베이스 테이블 생성 (Table Editor)

분석 단위(`analyses`)와 그 안의 단어들(`words`)을 나누어 관리하는 구조.
Supabase 좌측 메뉴 **Table Editor**에서 아래 두 테이블을 순서대로 생성.

### analyses 테이블 (분석 히스토리 정보)

| 컬럼         | 타입          | 설정                            |
| ------------ | ------------- | ------------------------------- |
| `id`         | `uuid`        | PK, 기본값: `gen_random_uuid()` |
| `user_id`    | `uuid`        | FK → `auth.users.id`            |
| `image_name` | `text`        |                                 |
| `created_at` | `timestamptz` | 기본값: `now()`                 |

### words 테이블 (추출된 개별 단어 정보)

| 컬럼          | 타입          | 설정                                                       |
| ------------- | ------------- | ---------------------------------------------------------- |
| `id`          | `uuid`        | PK, 기본값: `gen_random_uuid()`                            |
| `user_id`     | `uuid`        | FK → `auth.users.id`                                       |
| `analysis_id` | `uuid`        | FK → `public.analyses.id`, **On Delete Cascade 설정 필수** |
| `word`        | `text`        |                                                            |
| `reading`     | `text`        |                                                            |
| `meaning`     | `text`        |                                                            |
| `level`       | `text`        |                                                            |
| `box_2d`      | `int4[]`      | 정수형 배열                                                |
| `created_at`  | `timestamptz` | 기본값: `now()`                                            |

---

## 2. 구글 로그인 활성화 (Authentication)

사용자가 로그인을 해야 테이블에 데이터를 쌓을 수 있음.

1. **Google Cloud Console**에서 프로젝트 생성
2. **API 및 서비스 > OAuth 동의 화면**에서 앱 정보 입력 후 저장
3. **사용자 인증 정보 > 인증 정보 만들기 > OAuth 클라이언트 ID** 생성 (유형: 웹 애플리케이션)
   - 승인된 리디렉션 URI에 Supabase Callback URL 입력
   - 확인 경로: Supabase > **Authentication > Providers > Google**
4. 발급된 **Client ID**와 **Client Secret**을 Supabase Google Provider 설정에 입력 후 저장

---

## 3. RLS 보안 정책 설정 (SQL Editor 또는 Policies)

이 설정이 없으면 코드에서 데이터 읽기/쓰기 시 권한 에러 발생.

**Authentication > Policies** 메뉴에서 `analyses`, `words` 테이블 각각에 정책 추가:

| 항목               | 값                                   |
| ------------------ | ------------------------------------ |
| Policy Name        | `Users can CRUD own data`            |
| Allowed Operations | ALL (Select, Insert, Update, Delete) |
| Target Roles       | `authenticated`                      |
| Using expression   | `auth.uid() = user_id`               |
| Check expression   | `auth.uid() = user_id`               |

---

## 4. 환경 변수 준비 (API Key)

코드에서 Supabase와 통신하기 위한 주소와 키 설정.

1. Supabase **Settings > API** 메뉴로 이동
2. **Project URL**과 **anon public Key**를 복사
3. 프로젝트 루트의 `.env` 파일에 저장

```env
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIs...
```
